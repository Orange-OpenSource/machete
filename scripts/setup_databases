#!/bin/bash -l

create_database() {
    postgres_path_command="postgres_path=\`find /var/vcap/data/packages/postgres/*/ -name bin\`"
    change_path_command="PATH=\$postgres_path:\$PATH"
    create_user_command="psql -h 0.0.0.0 -U vcap -p 5524 -d postgres -c \"create user buildpacks with encrypted password 'buildpacks'\""
    drop_buildpacks_db_command="psql -h 0.0.0.0 -U vcap -p 5524 -d postgres -c \"drop database buildpacks\""
    drop_wordpress_db_command="psql -h 0.0.0.0 -U vcap -p 5524 -d postgres -c \"drop database wordpress\""
    create_buildpacks_db_command="psql -h 0.0.0.0 -U vcap -p 5524 -d postgres -c \"create database buildpacks with owner buildpacks\""
    create_wordpress_db_command="psql -h 0.0.0.0 -U vcap -p 5524 -d postgres -c \"create database wordpress with owner buildpacks\""
    bosh ssh --gateway_user vcap postgres_z1 0 --default_password p "$postgres_path_command;$change_path_command;$drop_buildpacks_db_command;$drop_wordpress_db_command;$create_user_command;$create_buildpacks_db_command;$create_wordpress_db_command"
}

cd $HOME/workspace/tmpboxes/first
bosh target 192.168.50.4
bosh login admin admin
create_database

cd $HOME/workspace/tmpboxes/second
bosh target 192.168.50.5
bosh login admin admin
create_database
